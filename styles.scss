/* ========= 配色與主題 ========= */
$themes: (
  sakura: (#fff0f5, #f9a8d4, #f472b6),
  ocean:  (#e0f7fa, #38bdf8, #0ea5e9),
  forest: (#ecfdf5, #4ade80, #16a34a),
  space:  (#0f172a, #818cf8, #6366f1),
  sunset: (#fff7ed, #fb923c, #f97316)
);

@mixin theme-skin($bg,$c1,$c2){
  background-color:$bg;

  .btn--primary{
    background:linear-gradient(135deg,$c1,$c2);
    box-shadow:0 10px 24px color-mix(in srgb, $c2 28%, transparent);
  }
  .btn--primary:hover{transform:translateY(-1px);box-shadow:0 14px 28px color-mix(in srgb, $c2 36%, transparent);}
  .btn--primary:active{transform:translateY(0);}

  .chip .num{background:$c1;}
  .chip:hover{transform:translateY(-2px);box-shadow:0 10px 18px rgba(0,0,0,.08);}

  .chip .del::before{background-color:$c2;}

  .card-back{background:linear-gradient(135deg,$c1,$c2);color:#fff;}
  .result{background:linear-gradient(135deg,$c1,$c2);color:#fff;box-shadow:inset 0 0 0 2px color-mix(in srgb, #fff 35%, $c2);}
  .alert-box{background:linear-gradient(135deg,$c1,$c2);color:#fff;}
  .success-box{
    background:linear-gradient(135deg, mix($c1,#fff,75%), mix($c2,#fff,75%));
    color:#0f172a;border-left:6px solid $c2;
  }
  .input:focus{outline:none;box-shadow:0 0 0 3px color-mix(in srgb, $c1 55%, white);}
}

/* ========= 全域基礎 ========= */
*{box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{
  margin:0;
  font-family:"Noto Sans JP", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  min-height:100vh;display:grid;place-items:center;
  font-size:clamp(16px, 1.2vw + 12px, 20px);
  line-height:1.55;overflow-x:hidden;
  color:#0f172a;
  text-rendering:optimizeLegibility;

  &.theme-sakura{@include theme-skin(nth(map-get($themes,sakura),1),nth(map-get($themes,sakura),2),nth(map-get($themes,sakura),3));}
  &.theme-ocean{@include theme-skin(nth(map-get($themes,ocean),1),nth(map-get($themes,ocean),2),nth(map-get($themes,ocean),3));}
  &.theme-forest{@include theme-skin(nth(map-get($themes,forest),1),nth(map-get($themes,forest),2),nth(map-get($themes,forest),3));}
  &.theme-space{@include theme-skin(nth(map-get($themes,space),1),nth(map-get($themes,space),2),nth(map-get($themes,space),3));}
  &.theme-sunset{@include theme-skin(nth(map-get($themes,sunset),1),nth(map-get($themes,sunset),2),nth(map-get($themes,sunset),3));}
}

/* ========= 主題背景（固定散落符號） ========= */
.theme-bg{
  position:fixed;inset:0;z-index:-1;pointer-events:none;
}
.theme-bg span{
  position:absolute;user-select:none;
  font-size:clamp(12px, 1.2vw + 10px, 28px);
  filter:drop-shadow(0 1px 1px rgba(0,0,0,.06));
  opacity:.18;
}

/* ========= 卡片與版面 ========= */
.app{width:min(1120px,100%);padding:clamp(12px, 2.2vw, 28px);}

.card{
  width:100%;
  background:rgba(255,255,255,.82);
  -webkit-backdrop-filter:saturate(140%) blur(8px);
  backdrop-filter:saturate(140%) blur(8px);
  border:1px solid rgba(255,255,255,.35);
  border-radius:28px;
  padding:clamp(16px, 2.2vw, 32px);
  box-shadow:0 12px 40px rgba(0,0,0,.12);
  display:flex;flex-direction:column;align-items:center;
  transition:box-shadow .2s ease;
}
.card:hover{box-shadow:0 16px 46px rgba(0,0,0,.14);}

.title{text-align:center;}
.title h1{
  font-family:"M PLUS Rounded 1c", "Noto Sans JP", sans-serif;
  font-weight:800;letter-spacing:.02em;
  font-size:clamp(26px, 3.4vw + 6px, 46px);
  margin:0 0 4px 0;
}
.hint{font-size:clamp(12px, 1vw + 8px, 16px);color:#334155;}
.theme-switcher{margin-top:12px;}
.theme-switcher label{font-weight:700;margin-right:8px;color:#0f172a;}
.theme-select{
  border-radius:12px;padding:12px 16px;
  font-size:clamp(16px, 1.2vw + 12px, 20px);
  border:1px solid rgba(0,0,0,.06);
  background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.06);
}

/* 提示 */
.alert-area,.success-area{
  min-height:32px;margin:10px 0;display:flex;align-items:center;justify-content:center;
}
.alert-box,.success-box{
  padding:12px 16px;border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.12);
  font-size:clamp(14px, 1vw + 10px, 16px);
  animation:slideIn .22s ease-out;
}

/* 動畫 */
@keyframes slideIn{0%{transform:translateY(-6px);opacity:0}100%{transform:translateY(0);opacity:1}}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.app{animation:fadeIn .28s ease-out both;}

/* 控件 */
.input,.btn{
  border-radius:14px;border:none;height:clamp(48px, 6vh, 60px);
  font-size:clamp(16px, 1.2vw + 10px, 20px);
}
.input{
  width:100%;padding:0 16px;background:rgba(255,255,255,.98);
  border:1px solid rgba(0,0,0,.06);
  box-shadow:0 4px 10px rgba(0,0,0,.05) inset, 0 2px 10px rgba(0,0,0,.06);
}
.btn{
  padding:0 clamp(16px, 1.6vw, 24px);
  cursor:pointer;display:inline-flex;align-items:center;justify-content:center;color:#fff;
  min-height:46px;transition:transform .12s ease, box-shadow .2s ease, opacity .2s ease;
  &--ghost{
    background:linear-gradient(135deg,#fde68a,#fcd34d);
    color:#78350f;
    box-shadow:0 10px 22px rgba(124,45,18,.15);
  }
  &--ghost:hover{transform:translateY(-1px);}
  &--danger{
    background:linear-gradient(135deg,#ef4444,#f87171);
    box-shadow:0 10px 22px rgba(239,68,68,.18);
  }
  &--danger:hover{transform:translateY(-1px);}
  &--disabled{opacity:.5;cursor:not-allowed;}
}

/* 叉叉圖示按鈕（關閉） */
.btn--icon{
  width:46px;height:46px;padding:0;border-radius:12px;position:relative;
}
.btn--icon::before{
  content:"";
  display:block;width:22px;height:22px;margin:auto;
  mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.3l6.3 6.29 6.29-6.29z"/></svg>') no-repeat center/contain;
  -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.3l6.3 6.29 6.29-6.29z"/></svg>') no-repeat center/contain;
  background:#fff;
}

/* 行列 */
.row{display:flex;gap:clamp(10px, 2vw, 16px);width:100%;}
.input-row{max-width:900px;margin:0 auto;}
.input-wrap{flex:1 1 auto;min-width:0;}
.add-btn{min-width:clamp(120px, 16vw, 180px);} /* 不與 input 重疊、略靠右 */

/* chips */
.chips{
  display:flex;flex-direction:column;gap:12px;margin-top:20px;
  padding-top:20px;border-top:3px dashed rgba(0,0,0,.1);width:100%;
}
.chip{
  display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:16px;background:rgba(255,255,255,.98);
  border:1px solid rgba(0,0,0,.06);
  box-shadow:0 8px 16px rgba(0,0,0,.06);
  transition:transform .15s ease, box-shadow .2s ease;
  word-break:break-word;
  .num{width:42px;height:42px;border-radius:50%;color:#fff;display:grid;place-items:center;font-weight:800;}
  .text{flex:1;overflow-wrap:anywhere;}
  .del{
    width:44px;height:44px;border-radius:10px;display:grid;place-items:center;cursor:pointer;border:none;background:#fff;
    box-shadow:0 4px 10px rgba(0,0,0,.06);
    transition:transform .12s ease, box-shadow .2s ease;
    &:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.10);}
    &::before{
      content:"";width:22px;height:22px;
      mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="black" viewBox="0 0 24 24"><path d="M9 3v1H4v2h16V4h-5V3H9zm-4 6v12h14V9H5zm2 2h2v8H7v-8zm6 0h2v8h-2v-8z"/></svg>') no-repeat center/contain;
      -webkit-mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="black" viewBox="0 0 24 24"><path d="M9 3v1H4v2h16V4h-5V3H9zm-4 6v12h14V9H5zm2 2h2v8H7v-8zm6 0h2v8h-2v-8z"/></svg>') no-repeat center/contain;
      background:#999;
    }
  }
}

.actions{display:flex;flex-wrap:wrap;gap:12px;margin-top:24px;width:100%;justify-content:center;}
.muted{color:#475569;font-size:clamp(12px, 1vw + 8px, 14px);text-align:center;}

.history{
  margin-top:20px;padding-top:12px;border-top:1px dashed rgba(0,0,0,.2);
  min-height:110px;word-break:break-word;overflow-wrap:anywhere;
  font-feature-settings:"palt" 1;
}
.history-nav{display:flex;gap:12px;justify-content:center;margin-top:10px;}

/* ========= Modal / 結果 ========= */
.modal-backdrop{
  position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.55);
  &.active{display:flex;}
}
.modal{
  width:min(900px,96%);border-radius:28px;background:rgba(255,255,255,.96);
  padding:clamp(16px, 2vw, 28px);position:relative;text-align:center;
  border:1px solid rgba(255,255,255,.35);
  box-shadow:0 16px 48px rgba(0,0,0,.35);
}
.modal-header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;}

.result{
  position:relative;display:flex;align-items:center;justify-content:center;margin:12px 0;border-radius:24px;
  padding:clamp(16px, 2vw, 24px);
  min-height:clamp(260px, 40vh, 420px);
  font-size:clamp(36px, 5.6vw, 72px);font-weight:900;text-align:center;
  word-break:break-word;overflow-wrap:anywhere;overflow:hidden;
  letter-spacing:.02em;
}

/* 翻面後的落下層（少量） */
.particles{position:absolute;inset:0;pointer-events:none;border-radius:24px;z-index:1;}
.fall-emoji{position:absolute;top:-2rem;animation:fall linear 4s 1;opacity:.9;font-size:clamp(18px, 2.4vw, 28px);}
@keyframes fall{
  0%{transform:translateY(-5vh) rotate(0);opacity:.95;}
  100%{transform:translateY(110%) rotate(360deg);opacity:0;}
}

/* 翻牌（灰卡 = 與結果區塊同尺寸，完全覆蓋） */
.card-inner{position:absolute;inset:0;z-index:2;perspective:1000px;margin:auto;}
.card-front,.card-back{
  position:absolute;inset:0;backface-visibility:hidden;border-radius:18px;
  display:flex;align-items:center;justify-content:center;
  font-size:clamp(28px, 4vw, 56px);font-weight:800;
  word-break:break-word;overflow-wrap:anywhere;padding:16px;text-align:center;
  text-shadow:0 1px 0 rgba(0,0,0,.05);
}
.card-front{
  background:#eef2f7;color:#1f2937;
  box-shadow:inset 0 0 0 2px rgba(0,0,0,.04);
}
.card-back{transform:rotateY(180deg);}
.card-inner.flip .card-front{transform:rotateY(180deg);}
.card-inner.flip .card-back{transform:rotateY(0deg);}

/* ========= RWD 強化 ========= */
@media (max-width: 900px){
  .input-row{max-width:100%;}
}
@media (max-width: 680px){
  .row{flex-direction:column;}
  .btn{width:100%;}
  .add-btn{min-width:100%;}
  .modal{width:100%;padding:16px;border-radius:0;min-height:100vh;display:flex;flex-direction:column;}
  .result{border-radius:0;flex:1;}
}

/* 無障礙／動畫降低偏好 */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001ms !important; animation-iteration-count:1 !important; transition-duration:.001ms !important;}
}
